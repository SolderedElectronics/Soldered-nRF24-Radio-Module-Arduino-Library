<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nRF24 Soldered Arduino Library: examples/InterruptConfigure/InterruptConfigure.ino</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">nRF24 Soldered Arduino Library<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">This is a library for nRF24 boards by Soldered.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('examples_2_interrupt_configure_2_interrupt_configure_8ino-example.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">examples/InterruptConfigure/InterruptConfigure.ino</div></div>
</div><!--header-->
<div class="contents">
<p>Written by <a href="http://github.com/2bndy5">2bndy5</a> in 2020</p>
<p>This example uses Acknowledgement (ACK) payloads attached to ACK packets to demonstrate how the nRF24L01's IRQ (Interrupt Request) pin can be configured to detect when data is received, or when data has transmitted successfully, or when data has failed to transmit.</p>
<p>This example was written to be used on 2 devices acting as "nodes". Use the Serial Monitor to change each node's behavior.</p>
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span>/**</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> **************************************************</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span> *</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> * @file        InterruptConfigure.ino</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span> * @brief       This example uses Acknowledgement (ACK) payloads attached to ACK packets to</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> *              demonstrate how the nRF24L01&#39;s IRQ (Interrupt Request) pin can be</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span> *              configured to detect when data is received, or when data has transmitted</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> *              successfully, or when data has failed to transmit.</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> *</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> *              This example was written to be used on 2 devices acting as &quot;nodes&quot;.</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> *              Use the Serial Monitor to change each node&#39;s behavior.</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> * </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span> *              See documentation at https://nRF24.github.io/RF24 for connections to MCU boards</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> *              See License information at root directory of this library</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> *</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> *</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> *              product: www.solde.red/333059</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> *</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> * @authors     Brendan Doherty</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> *              Modified by: Soldered</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> ***************************************************/</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>#include &quot;nRF24-SOLDERED.h&quot;</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>// We will be using the nRF24L01&#39;s IRQ pin for this example</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>#define IRQ_PIN 2                     // this needs to be a digital input capable pin</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>volatile bool wait_for_event = false; // used to wait for an IRQ event to trigger</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>// instantiate an object for the nRF24L01 transceiver</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>nRF24 radio(7, 8); // using pin 7 for the CE pin, and pin 8 for the CSN pin</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>// Let these addresses be used for the pair</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>uint8_t address[][6] = {&quot;1Node&quot;, &quot;2Node&quot;};</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>// It is very helpful to think of an address as a path instead of as</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>// an identifying device destination</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>// to use different addresses on a pair of radios, we need a variable to</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>// uniquely identify which address this radio will use to transmit</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>bool radioNumber = 1; // 0 uses address[0] to transmit, 1 uses address[1] to transmit</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>// Used to control whether this node is sending or receiving</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>bool role = false; // true = TX node, false = RX node</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>// For this example, we&#39;ll be using a payload containing</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>// a string that changes on every transmission. (successful or not)</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>// Make a couple arrays of payloads &amp; an iterator to traverse them</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>const uint8_t tx_pl_size = 5;</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>const uint8_t ack_pl_size = 4;</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>uint8_t pl_iterator = 0;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>// The &quot; + 1&quot; compensates for the c-string&#39;s NULL terminating 0</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>char tx_payloads[][tx_pl_size + 1] = {&quot;Ping &quot;, &quot;Pong &quot;, &quot;Radio&quot;, &quot;1FAIL&quot;};</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>char ack_payloads[][ack_pl_size + 1] = {&quot;Yak &quot;, &quot;Back&quot;, &quot; ACK&quot;};</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>void interruptHandler(); // prototype to handle IRQ events</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>void printRxFifo();      // prototype to print RX FIFO with 1 buffer</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>void setup()</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>{</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    Serial.begin(115200);</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    while (!Serial)</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    {</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        // some boards need to wait to ensure access to serial over USB</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    }</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    // initialize the transceiver on the SPI bus</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    if (!radio.begin())</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    {</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>        Serial.println(&quot;radio hardware is not responding!!&quot;);</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>        while (1)</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>        {</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>        } // hold in infinite loop</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    }</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    // print example&#39;s introductory prompt</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    Serial.println(F(&quot;RF24/examples/InterruptConfigure&quot;));</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    // To set the radioNumber via the Serial monitor on startup</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    Serial.println(F(&quot;Which radio is this? Enter &#39;0&#39; or &#39;1&#39;. Defaults to &#39;0&#39;&quot;));</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    while (!Serial.available())</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    {</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        // wait for user input</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    }</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    char input = Serial.parseInt();</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    radioNumber = input == 1;</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    Serial.print(F(&quot;radioNumber = &quot;));</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    Serial.println((int)radioNumber);</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    // role variable is hardcoded to RX behavior, inform the user of this</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    Serial.println(F(&quot;*** PRESS &#39;T&#39; to begin transmitting to the other node&quot;));</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    // setup the IRQ_PIN</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    pinMode(IRQ_PIN, INPUT);</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    attachInterrupt(digitalPinToInterrupt(IRQ_PIN), interruptHandler, FALLING);</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    // IMPORTANT: do not call radio.available() before calling</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    // radio.whatHappened() when the interruptHandler() is triggered by the</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    // IRQ pin FALLING event. According to the datasheet, the pipe information</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    // is unreliable during the IRQ pin FALLING transition.</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    // Set the PA Level low to try preventing power supply related problems</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    // because these examples are likely run with nodes in close proximity to</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    // each other.</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    radio.setPALevel(RF24_PA_LOW); // RF24_PA_MAX is default.</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span> </div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    // For this example we use acknowledgment (ACK) payloads to trigger the</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    // IRQ pin when data is received on the TX node.</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    // to use ACK payloads, we need to enable dynamic payload lengths</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    radio.enableDynamicPayloads(); // ACK payloads are dynamically sized</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    // Acknowledgement packets have no payloads by default. We need to enable</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    // this feature for all nodes (TX &amp; RX) to use ACK payloads.</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    radio.enableAckPayload();</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    // Fot this example, we use the same address to send data back and forth</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    // set the TX address of the RX node into the TX pipe</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    radio.openWritingPipe(address[radioNumber]); // always uses pipe 0</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    // set the RX address of the TX node into a RX pipe</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    radio.openReadingPipe(1, address[!radioNumber]); // using pipe 1</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    // additional setup specific to the node&#39;s role</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    if (role)</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    {</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        // setup for TX mode</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>        radio.stopListening(); // put radio in TX mode</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    }</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    else</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    {</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>        // setup for RX mode</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        // let IRQ pin only trigger on &quot;data ready&quot; event in RX mode</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        radio.maskIRQ(1, 1, 0); // args = &quot;data_sent&quot;, &quot;data_fail&quot;, &quot;data_ready&quot;</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span> </div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        // Fill the TX FIFO with 3 ACK payloads for the first 3 received</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>        // transmissions on pipe 1</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>        radio.writeAckPayload(1, &amp;ack_payloads[0], ack_pl_size);</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>        radio.writeAckPayload(1, &amp;ack_payloads[1], ack_pl_size);</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        radio.writeAckPayload(1, &amp;ack_payloads[2], ack_pl_size);</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>        radio.startListening(); // put radio in RX mode</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    }</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span> </div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    // For debugging info</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    // printf_begin();             // needed only once for printing details</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    // radio.printDetails();       // (smaller) function that prints raw register values</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    // radio.printPrettyDetails(); // (larger) function that prints human readable data</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>}</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>void loop()</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>{</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    if (role &amp;&amp; !wait_for_event)</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    {</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span> </div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>        // delay(1); // wait for IRQ pin to fully RISE</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        // This device is a TX node. This if block is only triggered when</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>        // NOT waiting for an IRQ event to happen</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        if (pl_iterator == 0)</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        {</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            // Test the &quot;data ready&quot; event with the IRQ pin</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span> </div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>            Serial.println(F(&quot;\nConfiguring IRQ pin to ignore the &#39;data sent&#39; event&quot;));</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>            radio.maskIRQ(true, false, false); // args = &quot;data_sent&quot;, &quot;data_fail&quot;, &quot;data_ready&quot;</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>            Serial.println(F(&quot;   Pinging RX node for &#39;data ready&#39; event...&quot;));</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        }</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        else if (pl_iterator == 1)</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>        {</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>            // Test the &quot;data sent&quot; event with the IRQ pin</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>            Serial.println(F(&quot;\nConfiguring IRQ pin to ignore the &#39;data ready&#39; event&quot;));</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>            radio.maskIRQ(false, false, true); // args = &quot;data_sent&quot;, &quot;data_fail&quot;, &quot;data_ready&quot;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>            Serial.println(F(&quot;   Pinging RX node for &#39;data sent&#39; event...&quot;));</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        }</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        else if (pl_iterator == 2)</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        {</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>            // Use this iteration to fill the RX node&#39;s FIFO which sets us up for the next test.</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>            // write() uses virtual interrupt flags that work despite the masking of the IRQ pin</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>            radio.maskIRQ(1, 1, 1); // disable IRQ masking for this step</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>            Serial.println(F(&quot;\nSending 1 payload to fill RX node&#39;s FIFO. IRQ pin is neglected.&quot;));</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>            // write() will call flush_tx() on &#39;data fail&#39; events</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>            if (radio.write(&amp;tx_payloads[pl_iterator], tx_pl_size))</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>            {</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>                if (radio.rxFifoFull())</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>                {</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>                    Serial.println(F(&quot;RX node&#39;s FIFO is full; it is not listening any more&quot;));</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                }</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                else</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                {</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                    Serial.println(&quot;Transmission successful, but the RX node might still be listening.&quot;);</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>                }</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>            }</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>            else</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>            {</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>                Serial.println(F(&quot;Transmission failed or timed out. Continuing anyway.&quot;));</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>                radio.flush_tx(); // discard payload(s) that failed to transmit</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>            }</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        }</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        else if (pl_iterator == 3)</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>        {</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>            // test the &quot;data fail&quot; event with the IRQ pin</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>            Serial.println(F(&quot;\nConfiguring IRQ pin to reflect all events&quot;));</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>            radio.maskIRQ(0, 0, 0); // args = &quot;data_sent&quot;, &quot;data_fail&quot;, &quot;data_ready&quot;</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>            Serial.println(F(&quot;   Pinging inactive RX node for &#39;data fail&#39; event...&quot;));</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        }</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        if (pl_iterator &lt; 4 &amp;&amp; pl_iterator != 2)</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>        {</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>            // IRQ pin is LOW when activated. Otherwise it is always HIGH</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>            // Wait until IRQ pin is activated.</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>            wait_for_event = true;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span> </div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>            // use the non-blocking call to write a payload and begin transmission</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>            // the &quot;false&quot; argument means we are expecting an ACK packet response</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            radio.startFastWrite(tx_payloads[pl_iterator++], tx_pl_size, false);</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>            // In this example, the &quot;data fail&quot; event is always configured to</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>            // trigger the IRQ pin active. Because the auto-ACK feature is on by</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>            // default, we don&#39;t need a timeout check to prevent an infinite loop.</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>        }</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>        else if (pl_iterator == 4)</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        {</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>            // all IRQ tests are done; flush_tx() and print the ACK payloads for fun</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            // CE pin is still HIGH which consumes more power. Example is now idling so...</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>            radio.stopListening(); // ensure CE pin is LOW</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            // stopListening() also calls flush_tx() when ACK payloads are enabled</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>            printRxFifo();</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            pl_iterator++;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>            // inform user what to do next</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>            Serial.println(F(&quot;\n*** PRESS &#39;T&#39; to restart the transmissions&quot;));</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>            Serial.println(F(&quot;*** PRESS &#39;R&#39; to change to Receive role\n&quot;));</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        }</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        else if (pl_iterator == 2)</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        {</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>            pl_iterator++; // proceed from step 3 to last step (stop at step 4 for readability)</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        }</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    }</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    else if (!role)</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    {</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        // This device is a RX node</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span> </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        if (radio.rxFifoFull())</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        {</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>            // wait until RX FIFO is full then stop listening</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>            delay(100);            // let ACK payload finish transmitting</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>            radio.stopListening(); // also discards unused ACK payloads</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>            printRxFifo();         // flush the RX FIFO</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span> </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>            // Fill the TX FIFO with 3 ACK payloads for the first 3 received</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            // transmissions on pipe 1.</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            radio.writeAckPayload(1, &amp;ack_payloads[0], ack_pl_size);</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            radio.writeAckPayload(1, &amp;ack_payloads[1], ack_pl_size);</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>            radio.writeAckPayload(1, &amp;ack_payloads[2], ack_pl_size);</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>            delay(100);             // let TX node finish its role</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>            radio.startListening(); // We&#39;re ready to start over. Begin listening.</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        }</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span> </div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    } // role</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    if (Serial.available())</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    {</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>        // change the role via the serial monitor</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>        char c = toupper(Serial.read());</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>        if (c == &#39;T&#39;)</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        {</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>            // Become the TX node</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            if (!role)</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>                Serial.println(F(&quot;*** CHANGING TO TRANSMIT ROLE -- PRESS &#39;R&#39; TO SWITCH BACK&quot;));</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            else</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>                Serial.println(F(&quot;*** RESTARTING IRQ PIN TEST ***&quot;));</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>            role = true;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>            wait_for_event = false;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>            pl_iterator = 0;  // reset the iterator</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>            radio.flush_tx(); // discard any payloads in the TX FIFO</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>            // startListening() clears the IRQ masks also. This is required for</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>            // continued TX operations when a transmission fails.</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            radio.stopListening(); // this also discards any unused ACK payloads</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>        }</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>        else if (c == &#39;R&#39; &amp;&amp; role)</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>        {</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>            // Become the RX node</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>            Serial.println(F(&quot;*** CHANGING TO RECEIVE ROLE -- PRESS &#39;T&#39; TO SWITCH BACK&quot;));</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>            role = false;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span> </div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            radio.maskIRQ(0, 0, 0); // the IRQ pin should only trigger on &quot;data ready&quot; event</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            // Fill the TX FIFO with 3 ACK payloads for the first 3 received</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>            // transmissions on pipe 1</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            radio.flush_tx(); // make sure there is room for 3 new ACK payloads</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>            radio.writeAckPayload(1, &amp;ack_payloads[0], ack_pl_size);</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            radio.writeAckPayload(1, &amp;ack_payloads[1], ack_pl_size);</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>            radio.writeAckPayload(1, &amp;ack_payloads[2], ack_pl_size);</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            radio.startListening();</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>        }</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    } // Serial.available()</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>} // loop</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span> </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>/**</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> * when the IRQ pin goes active LOW, call this fuction print out why</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span> */</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>void interruptHandler()</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>{</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    // print IRQ status and all masking flags&#39; states</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span> </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    Serial.println(F(&quot;\tIRQ pin is actively LOW&quot;)); // show that this function was called</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    delayMicroseconds(250);</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    bool tx_ds, tx_df, rx_dr;                // declare variables for IRQ masks</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    radio.whatHappened(tx_ds, tx_df, rx_dr); // get values for IRQ masks</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    // whatHappened() clears the IRQ masks also. This is required for</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    // continued TX operations when a transmission fails.</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    // clearing the IRQ masks resets the IRQ pin to its inactive state (HIGH)</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    Serial.print(F(&quot;\tdata_sent: &quot;));</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    Serial.print(tx_ds); // print &quot;data sent&quot; mask state</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    Serial.print(F(&quot;, data_fail: &quot;));</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    Serial.print(tx_df); // print &quot;data fail&quot; mask state</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    Serial.print(F(&quot;, data_ready: &quot;));</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    Serial.println(rx_dr); // print &quot;data ready&quot; mask state</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>    if (tx_df)            // if TX payload failed</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>        radio.flush_tx(); // clear all payloads from the TX FIFO</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    // print if test passed or failed. Unintentional fails mean the RX node was not listening.</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    // pl_iterator has already been incremented by now</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    if (pl_iterator &lt;= 1)</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    {</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>        Serial.print(F(&quot;   &#39;Data Ready&#39; event test &quot;));</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>        Serial.println(rx_dr ? F(&quot;passed&quot;) : F(&quot;failed&quot;));</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    }</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    else if (pl_iterator == 2)</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    {</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        Serial.print(F(&quot;   &#39;Data Sent&#39; event test &quot;));</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>        Serial.println(tx_ds ? F(&quot;passed&quot;) : F(&quot;failed&quot;));</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    }</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    else if (pl_iterator == 4)</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    {</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>        Serial.print(F(&quot;   &#39;Data Fail&#39; event test &quot;));</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>        Serial.println(tx_df ? F(&quot;passed&quot;) : F(&quot;failed&quot;));</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    }</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    wait_for_event = false; // ready to continue with loop() operations</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>} // interruptHandler</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span> </div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>/**</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span> * Print the entire RX FIFO with one buffer. This will also flush the RX FIFO.</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span> * Remember that the payload sizes are declared as tx_pl_size and ack_pl_size.</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> */</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>void printRxFifo()</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>{</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    if (radio.available())</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    { // if there is data in the RX FIFO</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        // to flush the data from the RX FIFO, we&#39;ll fetch it all using 1 buffer</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        uint8_t pl_size = !role ? tx_pl_size : ack_pl_size;</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>        char rx_fifo[pl_size * 3 + 1]; // RX FIFO is full &amp; we know ACK payloads&#39; size</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>        if (radio.rxFifoFull())</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>        {</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>            rx_fifo[pl_size * 3] = 0;          // add a NULL terminating char to use as a c-string</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>            radio.read(&amp;rx_fifo, pl_size * 3); // this clears the RX FIFO (for this example)</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>        }</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>        else</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        {</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>            uint8_t i = 0;</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>            while (radio.available())</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>            {</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>                radio.read(&amp;rx_fifo + (i * pl_size), pl_size);</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>                i++;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>            }</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>            rx_fifo[i * pl_size] = 0; // add a NULL terminating char to use as a c-string</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        }</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>        Serial.print(F(&quot;Complete RX FIFO: &quot;));</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        Serial.println(rx_fifo); // print the entire RX FIFO with 1 buffer</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    }</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath">
    <!-- id is needed for treeview function! -->
    <ul>
        <li class="footer">
            Generated on Thu Sep 19 2024 06:48:49 for nRF24 Soldered Arduino Library by <a href="http://www.doxygen.org/index.html">
                <img class="footer" src="doxygen.png" alt="doxygen"
                    onerror="this.onerror=null;this.src='doxygen.svg';" /></a> 1.12.0.
            Dark theme by <a href="http://majerle.eu" target="_new">Tilen Majerle</a>. All rights reserved.
            Copyright: <a href="https://www.soldered.com">Soldered</a>
        </li>
    </ul>
</div>
<script src="custom.js"></script>
</body>
</html>
